(()=>{"use strict";var e={20:(e,t,n)=>{var o=n(609),a=Symbol.for("react.element"),r=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var o,r={},l=null,d=null;for(o in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)s.call(t,o)&&!c.hasOwnProperty(o)&&(r[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===r[o]&&(r[o]=t[o]);return{$$typeof:a,type:e,key:l,ref:d,props:r,_owner:i.current}}t.Fragment=r,t.jsx=l,t.jsxs=l},848:(e,t,n)=>{e.exports=n(20)},609:e=>{e.exports=window.React}},t={};const n=window.wc.wcBlocksRegistry,o=window.wc.wcSettings,a="braintree_paypal",r="braintree-paypal";let s=null;const i=()=>{if(null!==s)return s;const e=(0,o.getSetting)(`${a}_data`,null);if(!e)throw new Error("Braintree Paypal initialization data is not available");const t=e.is_checkout_confirmation||!1;return s={ajaxUrl:e.ajax_url||"",buttonStyles:e.button_styles||{},buttonWidth:e.button_width||null,clientTokenNonce:e.client_token_nonce||"",setPaymentMethodNonce:e.set_payment_method_nonce||"",debug:e.debug||!1,description:e.description||"",forceBuyerCountry:e.force_buyer_country||"",integrationErrorMessage:e.integration_error_message||"Unknown error",isTestEnvironment:e.is_test_environment||!1,isPayPalPayLaterEnabled:e.is_paypal_pay_later_enabled||!1,isPayPalCardEnabled:e.is_paypal_card_enabled||!1,logoUrl:e.logo_url||"",messageLogoType:e.messaging_logo_type||"inline",messageLogoPosition:e.messaging_logo_position||"left",messageTextColor:e.messaging_text_color||"black",paymentErrorMessage:e.payment_error_message||"Unknown error",payPalDisabledFundingOptions:e.paypal_disabled_funding_options||[],payPalIntent:e.paypal_intent||"",paypalLocale:e.paypal_locale||"en_us",showSavedCards:e.show_saved_cards&&!t||!1,showSaveOption:e.show_save_option&&!t||!1,supports:e.supports||{},title:e.title||"",tokenizationForced:e.tokenization_forced||!1,isCheckoutConfirmation:e.is_checkout_confirmation||!1,payPalCustomerDetails:e.paypal_customer_details||{},cartPaymentNonce:e.cart_payment_nonce||"",cartHandlerUrl:e.cart_handler_url||"",cartCheckoutEnabled:e.cart_checkout_enabled||!1},s},c=(e,t=null)=>{i().debug&&(console.log(`Braintree (PayPal): ${e}`),t&&console.log(t))},l=window.wp.i18n,d=window.wp.data,p=window.wp.element;var u=function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}(848);const{buttonWidth:m,integrationErrorMessage:y}=i(),g=({loadPayPalSDK:e,onError:t,buttonLoaded:n,isCheckoutConfirmation:o=!1})=>{const a=(0,p.useRef)(!1),r="wc-braintree-paypal-button-container";if((0,p.useEffect)((()=>{let o,s;return a.current=!0,async function(){try{const{dataCollectorInstance:t,paypalCheckoutInstance:i}=await e(r,a);a.current&&n(!0),o=i,s=t}catch(e){c(`Integration Error: ${e.message}`,e),t(y)}}(),()=>{a.current=!1,n(!1),o&&o.teardown(),s&&s.teardown()}}),[e,t,n]),o)return null;const s=m?{width:`${m}px`}:{};return(0,u.jsx)("div",{id:r,style:s})},{buttonWidth:h,messageLogoType:w,messageLogoPosition:_,messageTextColor:b,isPayPalPayLaterEnabled:P}=i(),f=({amount:e})=>{const t="wc-braintree-paypal-pay-later-messaging-container";(0,p.useEffect)((()=>{if(!P)return;const n=document.getElementById(t);return n?paypal.Messages?void paypal.Messages({amount:e,style:{layout:"text",logo:{type:w,position:_},text:{color:b}}}).render(`#${t}`).catch((e=>{c(`Could not render the PayPal Pay Later messeging: ${e.message}`,e)})):n.style.display="none":void 0}),[e]);const n=h?{width:`${h}px`}:{};return(0,u.jsx)("div",{id:t,style:n})},S=window.wp.htmlEntities,k=window.wc.blocksCheckout,{description:E,isTestEnvironment:C}=i(),x=({testAmount:e,setTestAmount:t})=>(0,u.jsxs)(u.Fragment,{children:[!!C&&(0,u.jsx)("span",{children:(0,l.__)("TEST MODE ENABLED","woocommerce-gateway-paypal-powered-by-braintree")}),(0,u.jsx)("p",{children:(0,S.decodeEntities)(E||"")}),!!C&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(k.ValidatedTextInput,{id:`wc-${r}-test-amount`,type:"text",label:(0,l.__)("Test Amount","woocommerce-gateway-paypal-powered-by-braintree"),value:e,onChange:t}),(0,u.jsx)("p",{style:{fontSize:"10px"},dangerouslySetInnerHTML:{__html:(0,l.sprintf)(/** translators: Placeholders: %1$s - <a> tag, %2$s - </a> tag */ /** translators: Placeholders: %1$s - <a> tag, %2$s - </a> tag */
(0,l.__)("Enter a %1$stest amount%2$s to trigger a specific error response, or leave blank to use the order total.","woocommerce-gateway-paypal-powered-by-braintree"),'<a href="https://developers.braintreepayments.com/reference/general/testing/php#test-amounts">',"</a>")}})]})]});function v(e,t,n){const o=t||new FormData;for(const t in e){if(!e.hasOwnProperty(t)||!e[t])continue;const a=n?`${n}[${t}]`:t;"object"==typeof e[t]?v(e[t],o,a):o.append(a,e[t])}return o}const{ajaxUrl:T,clientTokenNonce:j,isTestEnvironment:A,buttonStyles:R,payPalIntent:M,isPayPalPayLaterEnabled:D,isPayPalCardEnabled:L,payPalDisabledFundingOptions:F,tokenizationForced:I,paypalLocale:O,forceBuyerCountry:$,cartPaymentNonce:B,cartHandlerUrl:N,setPaymentMethodNonce:U,paymentErrorMessage:z}=i(),K=({billing:{cartTotal:e,currency:t},onSubmit:n,shouldSavePayment:o,token:s=null,isExpress:i=!1,needsShipping:l=!1})=>{const[d,u]=(0,p.useState)(!1),[m,y]=(0,p.useState)(B||""),g=(0,p.useRef)(m),[h,w]=(0,p.useState)(""),[_,b]=(0,p.useState)(""),P=t.code,f=(e.value/10**t.minorUnit).toFixed(2),S=(0,p.useMemo)((()=>!o&&!I),[o]);i&&(R.label="checkout"),(0,p.useEffect)((()=>{g.current=m,d&&m&&n()}),[m,n,d]);const k=(0,p.useCallback)(((e,t)=>{const n={env:A?"sandbox":"production",commit:!i,style:R,onApprove:(t,n)=>e.tokenizePayment(t).then((function(e){if(c("Payment tokenized.",e),i&&e)return e.wp_nonce=U,((e,t)=>{if(t&&t.nonce)return fetch(e,{method:"POST",body:v(t)}).then((e=>e.json()))})(N,e).then((e=>{if(!e||!e.redirect_url)throw new Error(z);window.location=e.redirect_url})).catch((e=>{y(""),c(`Payment Error: ${e.message}`,e)}));y(e.nonce),u(!0)})),onError(e){y(""),c(`Payment Error: ${e.message}`,e)}},o=()=>e.createPayment({flow:S?"checkout":"vault",intent:S?M:"tokenize",amount:f,currency:P,locale:O,enableShippingAddress:l});S?n.createOrder=o:n.createBillingAgreement=o;const a=document.getElementById(t);if(a&&(a.innerHTML=""),document.getElementById(t))return paypal.Buttons(n).render(`#${t}`)}),[f,P,i,S,l]),E=(0,p.useMemo)((()=>{const[e,t]=[[],F];L||t.push("card"),D?e.push("paylater"):t.push("paylater");const n={components:D?"buttons,messages":"buttons",currency:P,intent:S?M:"tokenize",vault:!S,commit:!i};return e.length&&(n["enable-funding"]=e.join(",")),t.length&&(n["disable-funding"]=t.join(",")),$&&(n["buyer-country"]=$),n}),[P,S,i]),C=(0,p.useCallback)((async(e="",t={})=>{const{braintree:n}=window,o={},r=await((e,t,n)=>{const o=new FormData;return o.append("action",`wc_${t}_get_client_token`),o.append("nonce",n),fetch(e,{method:"POST",body:o}).then((e=>e.json())).then((e=>{if(e&&!e.success){const t=e.data&&e.data.message||"";throw new Error(`Could not retrieve the client token via AJAX: ${t}`)}if(e&&e.success&&e.data)return e.data}))})(T,a,j);c("Creating client");const s=await n.client.create({authorization:r});c("Client ready");try{const e=await n.dataCollector.create({client:s});e&&e.deviceData&&(t.current&&w(e.deviceData),o.dataCollectorInstance=e)}catch(e){c(e)}if(e){c("Creating integration");const t=await n.paypalCheckout.create({client:s});await t.loadPayPalSDK(E),await k(t,e),o.paypalCheckoutInstance=t,c("Integration ready")}return o}),[k,E]),x=(0,p.useCallback)((()=>{const e={wc_braintree_paypal_payment_nonce:g.current,wc_braintree_device_data:h};return S||(e[`wc-${r}-tokenize-payment-method`]=!0),s&&(e[`wc-${r}-payment-token`]=s,e.token=s,e.isSavedToken=!0),_&&(e[`wc-${r}-test-amount`]=_),e}),[h,S,_,s]);return{amount:f,testAmount:_,setTestAmount:b,loadPayPalSDK:C,getPaymentMethodData:x}},H=({checkoutFormHandler:e,eventRegistration:t,emitResponse:n})=>{const{onPaymentProcessing:o,onCheckoutAfterProcessingWithError:a,onCheckoutAfterProcessingWithSuccess:r}=t,{getPaymentMethodData:s}=e;return((e,t,n)=>{(0,p.useEffect)((()=>e((()=>{const e=n();return e&&(e.token||e.wc_braintree_paypal_payment_nonce)?{type:t.responseTypes.SUCCESS,meta:{paymentMethodData:e}}:{type:t.responseTypes.ERROR,message:i().paymentErrorMessage,messageContext:t.noticeContexts.PAYMENTS}}))),[t.responseTypes.SUCCESS,e,n,t.responseTypes.ERROR,t.noticeContexts.PAYMENTS])})(o,n,s),((e,t,n)=>{(0,p.useEffect)((()=>{const o=e=>{let t={type:n.responseTypes.SUCCESS};const{paymentStatus:o,paymentDetails:a}=e.processingResponse;return o===n.responseTypes.FAIL&&a.result===n.responseTypes.FAIL&&a.message&&(t={type:n.responseTypes.FAIL,message:a.message,messageContext:n.noticeContexts.PAYMENTS,retry:!0}),t},a=e(o),r=t(o);return()=>{a(),r()}}),[e,t,n.noticeContexts.PAYMENTS,n.responseTypes.FAIL,n.responseTypes.SUCCESS])})(a,r,n),null},{isCheckoutConfirmation:Y,payPalCustomerDetails:W}=i(),q=(0,o.getSetting)("isBlockTheme")?"wc-block-components-notice-banner is-error":"woocommerce-error",J=(e,t)=>t?(Object.keys(t).forEach((e=>{""===t[e]&&delete t[e]})),{...e,...t}):e,V=e=>{const[t,n]=(0,p.useState)(null),[o,r]=(0,p.useState)(!1),{eventRegistration:s,emitResponse:i,activePaymentMethod:c,components:{LoadingMask:l},billing:m,onSubmit:y,shouldSavePayment:h,token:w,shippingData:_}=e,b=K({billing:m,onSubmit:y,shouldSavePayment:h,token:w,isExpress:!1,needsShipping:_.needsShipping}),{loadPayPalSDK:P,testAmount:S,setTestAmount:k,amount:E}=b;return(0,p.useEffect)((()=>{if(Y)return;const e=document.querySelector("button.wc-block-components-checkout-place-order-button");return e?(c===a&&e.setAttribute("disabled","disabled"),()=>{e.removeAttribute("disabled")}):void 0}),[c]),(0,p.useEffect)((()=>{if(Y&&W&&!window.wcBraintreePayPalAddressFilled){try{const{billing:e,shipping:t}=W,n=(0,d.select)("wc/store/cart").getCustomerData(),o={};o.billing=J(n.billingAddress,e),o.shipping=J(n.shippingAddress,t),o.billing&&(0,d.dispatch)("wc/store/cart").setBillingAddress(o.billing),_.needsShipping&&o.shipping&&(0,d.dispatch)("wc/store/cart").setShippingAddress(o.shipping)}catch(e){console.error(e)}window.wcBraintreePayPalAddressFilled=!0}}),[]),(0,u.jsxs)(u.Fragment,{children:[!Y&&(0,u.jsx)(x,{testAmount:S,setTestAmount:k}),t&&(0,u.jsx)("div",{className:q,children:t}),!t&&(0,u.jsxs)(l,{isLoading:!o,showSpinner:!0,children:[o&&!Y&&(0,u.jsx)(f,{amount:E}),(0,u.jsx)(g,{loadPayPalSDK:P,onError:n,buttonLoaded:r,isCheckoutConfirmation:Y})]}),(0,u.jsx)(H,{checkoutFormHandler:b,eventRegistration:s,emitResponse:i})]})},{PAYMENT_STORE_KEY:X}=window.wc.wcBlocksData,{logoUrl:G,title:Q,showSavedCards:Z,showSaveOption:ee,supports:te,isCheckoutConfirmation:ne}=i(),oe=()=>(0,u.jsx)("img",{src:G,alt:Q}),ae=({RenderedComponent:e,...t})=>(0,d.select)("core/editor")?null:(0,u.jsx)(e,{...t});let re=te;if(ne){const e=(0,d.subscribe)((()=>{(0,d.select)(X).paymentMethodsInitialized()&&(e(),(0,d.dispatch)(X).__internalSetActivePaymentMethod(a))}),X);re=[...te,"braintree_paypal_checkout_confirmation"]}const se={name:a,label:(0,u.jsx)(oe,{}),ariaLabel:(0,l.__)("Braintree PayPal Payment Method","woocommerce-gateway-paypal-powered-by-braintree"),canMakePayment:()=>!0,content:(0,u.jsx)(ae,{RenderedComponent:V}),edit:(0,u.jsx)(ae,{RenderedComponent:V}),savedTokenComponent:(0,u.jsx)(ae,{RenderedComponent:e=>{const{eventRegistration:t,emitResponse:n}=e,o=K(e),{loadPayPalSDK:a}=o,r=(0,p.useRef)(!1);return(0,p.useEffect)((()=>{let e;return r.current=!0,async function(){const{dataCollectorInstance:t}=await a("",r);e=t}(),()=>{r.current=!1,e&&e.teardown&&e.teardown()}}),[a]),(0,u.jsx)(H,{checkoutFormHandler:o,eventRegistration:t,emitResponse:n})}}),supports:{showSavedCards:Z||!1,showSaveOption:ee||!1,features:re||[]}},ie=(0,o.getSetting)("isBlockTheme")?"wc-block-components-notice-banner is-error":"woocommerce-error",ce=e=>{const[t,n]=(0,p.useState)(null),[o,a]=(0,p.useState)(!1),{components:{LoadingMask:r},billing:s,onSubmit:i,shouldSavePayment:c,token:l,shippingData:d}=e,m=K({billing:s,onSubmit:i,shouldSavePayment:c,token:l,isExpress:!0,needsShipping:d.needsShipping}),{loadPayPalSDK:y,amount:h}=m;return(0,u.jsxs)(u.Fragment,{children:[t&&(0,u.jsx)("div",{className:ie,children:t}),!t&&(0,u.jsxs)(r,{isLoading:!o,children:[o&&(0,u.jsx)(f,{amount:h}),(0,u.jsx)(g,{loadPayPalSDK:y,onError:n,buttonLoaded:a})]})]})},{supports:le}=i(),de=({RenderedComponent:e,...t})=>(0,d.select)("core/editor")?null:(0,u.jsx)(e,{...t}),pe={name:a+"_express",canMakePayment:()=>!0,content:(0,u.jsx)(de,{RenderedComponent:ce}),edit:(0,u.jsx)(de,{RenderedComponent:ce}),supports:{features:le||[]}},{cartCheckoutEnabled:ue}=i();(0,n.registerPaymentMethod)(se),ue&&(0,n.registerExpressPaymentMethod)(pe)})();