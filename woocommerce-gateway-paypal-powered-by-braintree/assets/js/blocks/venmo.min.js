(()=>{"use strict";var e={20:(e,t,n)=>{var o=n(609),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var o,a={},l=null,u=null;for(o in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,o)&&!c.hasOwnProperty(o)&&(a[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===a[o]&&(a[o]=t[o]);return{$$typeof:r,type:e,key:l,ref:u,props:a,_owner:i.current}}t.Fragment=a,t.jsx=l,t.jsxs=l},848:(e,t,n)=>{e.exports=n(20)},609:e=>{e.exports=window.React}},t={};const n=window.wc.wcBlocksRegistry,o=window.wc.wcSettings,r="braintree_venmo",a="braintree-venmo";let s=null;const i=()=>{if(null!==s)return s;const e=(0,o.getSetting)(`${r}_data`,null);if(!e)throw new Error("Braintree Venmo initialization data is not available");const t=e.is_checkout_confirmation||!1;return s={ajaxUrl:e.ajax_url||"",clientTokenNonce:e.client_token_nonce||"",debug:e.debug||!1,description:e.description||"",paymentUsage:e.payment_usage||"single_use",cartPaymentNonce:e.cart_payment_nonce||"",showSavedCards:e.show_saved_cards&&!t||!1,showSaveOption:e.show_save_option&&!t||!1,supports:e.supports||{},title:e.title||"",tokenizationForced:e.tokenization_forced||!1,isCheckoutConfirmation:t,checkoutConfirmationDescription:e.checkout_confirmation_description||"",pluginUrl:e.plugin_url||"",cartCheckoutEnabled:e.cart_checkout_enabled||!1,cartHandlerUrl:e.cart_handler_url||"",cartHandlerNonce:e.set_payment_method_nonce||""},s},c=(e,t=null)=>{i().debug&&(console.log(`Braintree (Venmo): ${e}`),t&&console.log(t))},l=window.wp.i18n,u=window.wp.element;var m=function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}(848);const d=({loadVenmoSDK:e,tokenizeVenmo:t,onError:n,setButtonLoaded:o,isCheckoutConfirmation:r=!1})=>{const[a,s]=(0,u.useState)(null),[d,p]=(0,u.useState)(!1),y=(0,u.useRef)(!1),w="braintree-venmo-button",{pluginUrl:h}=i(),_=`${h}/assets/images/white_venmo_logo.svg`;return(0,u.useEffect)((()=>(y.current=!0,()=>{y.current=!1})),[]),(0,u.useEffect)((()=>{r?o(!0):(async()=>{try{const{venmoInstance:t}=await e(w,y);if(y.current){if(!t.isBrowserSupported())return c("Venmo not supported in this browser"),n((0,l.__)("Venmo is not supported in this browser. Please try another payment method.","woocommerce-gateway-paypal-powered-by-braintree")),void o(!0);s(t),o(!0)}}catch(e){c("Error loading Venmo SDK",e),y.current&&n((0,l.__)("Venmo is currently unavailable. Please try another payment method.","woocommerce-gateway-paypal-powered-by-braintree"))}})()}),[e,o,n,r]),r?null:(0,m.jsx)("div",{className:"wc-braintree-venmo-button-container",children:(0,m.jsx)("button",{id:w,type:"button",className:"wc-braintree-venmo-button",onClick:async()=>{if(a&&!d){p(!0),n(null);try{if(!a.isBrowserSupported())throw new Error((0,l.__)("Venmo is not supported in this browser.","woocommerce-gateway-paypal-powered-by-braintree"));await t(a)}catch(e){c("Venmo error",e),"VENMO_CANCELED"===e.code||"VENMO_DESKTOP_CANCELED"===e.code||"VENMO_APP_CANCELED"===e.code?n(null):n((0,l.__)("Venmo authorization failed. Please try again.","woocommerce-gateway-paypal-powered-by-braintree"))}finally{y.current&&p(!1)}}},disabled:!a||d,children:(0,m.jsx)("img",{src:_,alt:(0,l.__)("Pay with Venmo","woocommerce-gateway-paypal-powered-by-braintree")})})})},{description:p}=i(),y=()=>p?(0,m.jsx)("div",{className:"braintree-venmo-description",children:p}):null;function w(e,t,n){const o=t||new FormData;for(const t in e){if(!e.hasOwnProperty(t)||!e[t])continue;const r=n?`${n}[${t}]`:t;"object"==typeof e[t]?w(e[t],o,r):o.append(r,e[t])}return o}const{ajaxUrl:h,clientTokenNonce:_,cartPaymentNonce:b,tokenizationForced:f}=i(),g=({billing:{cartTotal:e,currency:t},onSubmit:n,shouldSavePayment:o,token:s=null})=>{const[i,l]=(0,u.useState)(!1),[m,d]=(0,u.useState)(b||""),p=(0,u.useRef)(m),[y,w]=(0,u.useState)(""),g=(e.value/10**t.minorUnit).toFixed(2),v=(0,u.useMemo)((()=>!o&&!f),[o,f]);(0,u.useEffect)((()=>{p.current=m,i&&m&&n()}),[m,n,i]);const S=(0,u.useCallback)((async(e="",t={})=>{const{braintree:n}=window,o={},a=await((e,t,n)=>{const o=new FormData;return o.append("action",`wc_${t}_get_client_token`),o.append("nonce",n),fetch(e,{method:"POST",body:o}).then((e=>e.json())).then((e=>{if(e&&!e.success){const t=e.data&&e.data.message||"";throw new Error(`Could not retrieve the client token via AJAX: ${t}`)}if(e&&e.success&&e.data)return e.data}))})(h,r,_);c("Creating client");const s=await n.client.create({authorization:a});c("Client ready");try{const e=await n.dataCollector.create({client:s});e&&e.deviceData&&(t.current&&w(e.deviceData),o.dataCollectorInstance=e)}catch(e){c(e)}if(e){c("Creating Venmo integration");const e=await n.venmo.create({client:s,paymentMethodUsage:v?"single_use":"multi_use",allowDesktop:!0});o.venmoInstance=e,c("Venmo integration ready")}return o}),[v]);return{amount:g,loadVenmoSDK:S,tokenizeVenmo:(0,u.useCallback)((async e=>{try{c("Tokenizing Venmo payment");const t=await e.tokenize();return c("Payment tokenized.",t),d(t.nonce),l(!0),t}catch(e){throw d(""),c(`Payment Error: ${e.message}`,e),e}}),[]),tokenizeVenmoExpress:(0,u.useCallback)((async e=>{try{c("Tokenizing Venmo express payment");const t=await e.tokenize();return c("Express payment tokenized.",t),t}catch(e){throw c(`Express Payment Error: ${e.message}`,e),e}}),[]),getPaymentMethodData:(0,u.useCallback)((()=>{const e={wc_braintree_venmo_payment_nonce:p.current,wc_braintree_device_data:y};return v||(e[`wc-${a}-tokenize-payment-method`]=!0),s&&(e[`wc-${a}-payment-token`]=s,e.token=s,e.isSavedToken=!0),e}),[y,v,s])}},v=({checkoutFormHandler:e,eventRegistration:t,emitResponse:n})=>{const{onPaymentProcessing:o,onCheckoutAfterProcessingWithError:r,onCheckoutAfterProcessingWithSuccess:a}=t;return((e,t,n)=>{const{onPaymentSetup:o}=t,{ERROR:r,SUCCESS:a}=n.responseTypes,s=(0,u.useRef)(e);(0,u.useEffect)((()=>{s.current=e}),[e]),(0,u.useEffect)((()=>o((()=>{const e=s.current.getPaymentMethodData();return e&&(e.isSavedToken||e.wc_braintree_venmo_payment_nonce)?{type:a,meta:{paymentMethodData:e}}:{type:r,message:(0,l.__)("Please complete Venmo authorization before placing your order.","woocommerce-gateway-paypal-powered-by-braintree")}}))),[o,r,a])})(e,t,n),((e,t,n)=>{(0,u.useEffect)((()=>{const o=e=>{let t={type:n.responseTypes.SUCCESS};const{paymentStatus:o,paymentDetails:r}=e.processingResponse;return o===n.responseTypes.FAIL&&r.result===n.responseTypes.FAIL&&r.message&&(t={type:n.responseTypes.FAIL,message:r.message,messageContext:n.noticeContexts.PAYMENTS,retry:!0}),t},r=e(o),a=t(o);return()=>{r(),a()}}),[e,t,n.noticeContexts.PAYMENTS,n.responseTypes.FAIL,n.responseTypes.SUCCESS])})(r,a,n),null},S=e=>{const[t,n]=(0,u.useState)(null),[o,a]=(0,u.useState)(!1),{isCheckoutConfirmation:s,checkoutConfirmationDescription:c}=i(),{eventRegistration:l,emitResponse:p,activePaymentMethod:w,components:{LoadingMask:h},billing:_,onSubmit:b,shouldSavePayment:f,token:S}=e,k=g({billing:_,onSubmit:b,shouldSavePayment:f,token:S}),{loadVenmoSDK:C,tokenizeVenmo:E}=k;return(0,u.useEffect)((()=>{if(s)return;const e=document.querySelector("button.wc-block-components-checkout-place-order-button");return e?(w===r&&(e.disabled=!0),()=>{e.disabled=!1}):void 0}),[w]),(0,m.jsxs)(m.Fragment,{children:[!s&&(0,m.jsx)(y,{}),s&&c&&(0,m.jsx)("div",{className:"braintree-venmo-checkout-confirmation-description",children:c}),t&&(0,m.jsx)("div",{className:"wc-block-components-notice-banner is-error",children:t}),!t&&(0,m.jsx)(h,{isLoading:!o,showSpinner:!0,children:(0,m.jsx)(d,{loadVenmoSDK:C,tokenizeVenmo:E,onError:n,setButtonLoaded:a,isCheckoutConfirmation:s})}),(0,m.jsx)(v,{checkoutFormHandler:k,eventRegistration:l,emitResponse:p})]})},{title:k,showSavedCards:C,showSaveOption:E,supports:x}=i(),P=()=>(0,m.jsx)("span",{children:k}),V=({RenderedComponent:e,...t})=>(0,m.jsx)(e,{...t}),j={name:r,label:(0,m.jsx)(P,{}),ariaLabel:(0,l.__)("Braintree Venmo Payment Method","woocommerce-gateway-paypal-powered-by-braintree"),canMakePayment:()=>!0,content:(0,m.jsx)(V,{RenderedComponent:S}),edit:(0,m.jsx)(V,{RenderedComponent:S}),savedTokenComponent:(0,m.jsx)(V,{RenderedComponent:e=>{const{eventRegistration:t,emitResponse:n}=e,o=g(e),{loadVenmoSDK:r}=o,a=(0,u.useRef)(!1);return(0,u.useEffect)((()=>{let e;return a.current=!0,async function(){const{dataCollectorInstance:t}=await r("",a);e=t}(),()=>{a.current=!1,e&&e.teardown&&e.teardown()}}),[r]),(0,m.jsx)(v,{checkoutFormHandler:o,eventRegistration:t,emitResponse:n})}}),supports:{showSavedCards:C||!1,showSaveOption:E||!1,features:x||[]}},R=window.wp.data,N=e=>{const[t,n]=(0,u.useState)(null),[o,r]=(0,u.useState)(!1),[a,s]=(0,u.useState)(null),[d,p]=(0,u.useState)(!1),[y,h]=(0,u.useState)(!0),_=(0,u.useRef)(!1),{pluginUrl:b,cartHandlerUrl:f,cartHandlerNonce:v}=i(),S=`${b}/assets/images/white_venmo_logo.svg`,{components:{LoadingMask:k},billing:C,onSubmit:E,shouldSavePayment:x}=e,P=g({billing:C,onSubmit:E,shouldSavePayment:x,token:null}),{loadVenmoSDK:V,tokenizeVenmoExpress:j}=P,R="braintree-venmo-express-button";return(0,u.useEffect)((()=>(_.current=!0,()=>{_.current=!1})),[]),(0,u.useEffect)((()=>{(async()=>{try{const{venmoInstance:e}=await V(R,_);if(_.current){if(!e.isBrowserSupported())return c("Venmo not supported in this browser"),void h(!1);s(e),r(!0)}}catch(e){console.error("Error loading Venmo SDK",e)}})()}),[V]),y?(0,m.jsxs)(m.Fragment,{children:[t&&(0,m.jsx)("div",{className:"wc-block-components-notice-banner is-error",children:t}),!t&&(0,m.jsx)(k,{isLoading:!o,children:(0,m.jsx)("div",{className:"wc-braintree-venmo-button-container wc-braintree-venmo-express-container",children:(0,m.jsx)("button",{id:R,type:"button",className:"wc-braintree-venmo-button wc-braintree-venmo-express-button",onClick:async()=>{if(a&&!d){p(!0),n(null);try{if(!a.isBrowserSupported())throw new Error((0,l.__)("Venmo is not supported in this browser.","woocommerce-gateway-paypal-powered-by-braintree"));const e=await j(a);if(e&&e.nonce){e.wp_nonce=v;const t=await((e,t)=>{if(t&&t.nonce)return fetch(e,{method:"POST",body:w(t)}).then((e=>e.json()))})(f,e);if(t&&t.redirect_url)return void(window.location=t.redirect_url);throw new Error((0,l.__)("Failed to process Venmo payment. Please try again.","woocommerce-gateway-paypal-powered-by-braintree"))}}catch(e){console.error("Venmo express error",e),_.current&&("VENMO_CANCELED"===e.code||"VENMO_DESKTOP_CANCELED"===e.code||"VENMO_APP_CANCELED"===e.code?n(null):n(e.message||(0,l.__)("Venmo authorization failed. Please try again.","woocommerce-gateway-paypal-powered-by-braintree")))}finally{_.current&&p(!1)}}},disabled:!a||d,children:(0,m.jsx)("img",{src:S,alt:(0,l.__)("Pay with Venmo","woocommerce-gateway-paypal-powered-by-braintree")})})})})]}):null},{supports:D}=i(),T=({RenderedComponent:e,...t})=>(0,R.select)("core/editor")?null:(0,m.jsx)(e,{...t}),O={name:r+"_express",canMakePayment:()=>!0,content:(0,m.jsx)(T,{RenderedComponent:N}),edit:(0,m.jsx)(T,{RenderedComponent:N}),supports:{features:D||[]}},{cartCheckoutEnabled:z}=i();(0,n.registerPaymentMethod)(j),z&&(0,n.registerExpressPaymentMethod)(O)})();