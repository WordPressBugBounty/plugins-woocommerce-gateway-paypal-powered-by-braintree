(()=>{"use strict";var e={32:(e,t,n)=>{n.d(t,{d:()=>r});var o=n(723);class r{static VENMO_CANCEL_CODES=["VENMO_CANCELED","VENMO_APP_CANCELED","VENMO_DESKTOP_CANCELED"];constructor(e){this.args=e||{},this.id=e.id,this.clientTokenNonce=e.client_token_nonce,this.ajaxUrl=e.ajax_url,this.debug=e.debug||!1,this.paymentUsage=e.payment_usage,this.braintreeClient=null,this.venmoInstance=null,this.dataCollectorInstance=null,this.deviceData=null,this.clientToken=null,this.isInitialized=!1,this.isProcessing=!1}async getClientToken(){const e={action:"wc_"+this.id+"_get_client_token",nonce:this.clientTokenNonce};try{const t=await jQuery.post(this.ajaxUrl,e);if(!t.success||!t.data)throw new Error(t.data?.message||"Failed to get client token");this.clientToken=t.data}catch(e){throw this.log("Error fetching client token:",e),e}}async createBraintreeClient(){return new Promise(((e,t)=>{"undefined"!=typeof braintree&&void 0!==braintree.client?braintree.client.create({authorization:this.clientToken},((n,o)=>{n?t(n):(this.braintreeClient=o,e(o))})):t(new Error("Braintree SDK not loaded"))}))}async createDataCollector(){return new Promise((e=>{if(void 0===braintree.dataCollector)return this.log("Data collector not available, skipping"),void e(null);braintree.dataCollector.create({client:this.braintreeClient,kount:!0},((t,n)=>{if(t)return this.log("Data collector creation failed:",t),void e(null);this.dataCollectorInstance=n,this.deviceData=n.deviceData,e(n)}))}))}async createVenmoInstance(){const e=this.paymentUsage;return this.log("Creating Venmo instance with payment usage:",e),new Promise(((t,n)=>{void 0!==braintree.venmo?braintree.venmo.create({client:this.braintreeClient,allowDesktop:!0,paymentMethodUsage:e,collectCustomerBillingAddress:!0,collectCustomerShippingAddress:!0},((e,o)=>{e?n(e):(this.venmoInstance=o,t(o))})):n(new Error("Braintree Venmo SDK not loaded"))}))}isBrowserSupported(){return!!this.venmoInstance&&this.venmoInstance.isBrowserSupported()}static isUserCancellation(e){return e&&r.VENMO_CANCEL_CODES.includes(e.code)}async tokenize(){return new Promise(((e,t)=>{this.venmoInstance.tokenize(((n,o)=>{n?t(n):e(o)}))}))}blockUI(e){jQuery(e).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}unblockUI(e){jQuery(e).unblock()}handleError(e){return this.log("Venmo error:",e),r.isUserCancellation(e)?null:e.message||(0,o.__)("An error occurred while processing your Venmo payment. Please try again.","woocommerce-gateway-paypal-powered-by-braintree")}showError(e,t){const n=jQuery(t);jQuery(".woocommerce-error, .woocommerce-message").remove(),n.prepend('<div class="woocommerce-error">'+e+"</div>"),jQuery("html, body").animate({scrollTop:n.offset().top-100},500)}log(...e){this.debug&&console.log("[Venmo]",...e)}}},723:e=>{e.exports=window.wp.i18n}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o=n(723),r=n(32);jQuery((function(e){class t extends r.d{constructor(e){super(e),this.setPaymentMethodNonce=e.set_payment_method_nonce,this.cartHandlerUrl=e.cart_handler_url,this.buttonContainerId="wc_"+this.id+"_button_container"}async init(){try{if(await this.getClientToken(),!this.clientToken)return void this.log("Failed to get client token");await this.createBraintreeClient(),await this.createDataCollector(),await this.createVenmoInstance(),await this.renderVenmoButton(),this.isInitialized=!0,this.log("Venmo cart button initialized")}catch(e){this.log("Venmo cart button initialization error:",e)}}async renderVenmoButton(){const e=document.getElementById(this.buttonContainerId);if(!e)return void this.log("Button container not found");if(!this.venmoInstance.isBrowserSupported())return this.log("Venmo not supported in this browser"),void(e.style.display="none");const t=document.createElement("button");t.type="button",t.id="wc_braintree_venmo_cart_button",t.className="wc-braintree-venmo-button";const n=document.createElement("img");n.src=this.args.venmo_logo_svg_url,n.alt=(0,o.__)("Pay with Venmo","woocommerce-gateway-paypal-powered-by-braintree"),t.appendChild(n),t.addEventListener("click",(e=>{e.preventDefault(),this.handleButtonClick()})),e.appendChild(t)}async handleButtonClick(){if(!this.isProcessing){this.isProcessing=!0,this.blockUI(".woocommerce");try{const e=await this.tokenize();await this.processCheckout(e)}catch(e){const t=this.handleError(e);t&&this.showError(t,".woocommerce"),this.isProcessing=!1,this.unblockUI(".woocommerce")}}}async processCheckout(t){const n={nonce:t.nonce,device_data:this.deviceData||"",wp_nonce:this.setPaymentMethodNonce};try{const t=await e.post(this.cartHandlerUrl,n);if(!t.redirect_url)throw new Error("No redirect URL received");window.location.href=t.redirect_url}catch(e){throw this.log("Error processing checkout:",e),e}}}window.WC_Braintree_Venmo_Cart_Handler=t}))})();