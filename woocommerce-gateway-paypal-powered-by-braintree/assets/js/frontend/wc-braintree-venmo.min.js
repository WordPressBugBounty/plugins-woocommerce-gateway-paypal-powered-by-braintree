(()=>{"use strict";var e={32:(e,t,n)=>{n.d(t,{d:()=>o});var r=n(723);class o{static VENMO_CANCEL_CODES=["VENMO_CANCELED","VENMO_APP_CANCELED","VENMO_DESKTOP_CANCELED"];constructor(e){this.args=e||{},this.id=e.id,this.clientTokenNonce=e.client_token_nonce,this.ajaxUrl=e.ajax_url,this.debug=e.debug||!1,this.paymentUsage=e.payment_usage,this.braintreeClient=null,this.venmoInstance=null,this.dataCollectorInstance=null,this.deviceData=null,this.clientToken=null,this.isInitialized=!1,this.isProcessing=!1}async getClientToken(){const e={action:"wc_"+this.id+"_get_client_token",nonce:this.clientTokenNonce};try{const t=await jQuery.post(this.ajaxUrl,e);if(!t.success||!t.data)throw new Error(t.data?.message||"Failed to get client token");this.clientToken=t.data}catch(e){throw this.log("Error fetching client token:",e),e}}async createBraintreeClient(){return new Promise(((e,t)=>{"undefined"!=typeof braintree&&void 0!==braintree.client?braintree.client.create({authorization:this.clientToken},((n,r)=>{n?t(n):(this.braintreeClient=r,e(r))})):t(new Error("Braintree SDK not loaded"))}))}async createDataCollector(){return new Promise((e=>{if(void 0===braintree.dataCollector)return this.log("Data collector not available, skipping"),void e(null);braintree.dataCollector.create({client:this.braintreeClient,kount:!0},((t,n)=>{if(t)return this.log("Data collector creation failed:",t),void e(null);this.dataCollectorInstance=n,this.deviceData=n.deviceData,e(n)}))}))}async createVenmoInstance(){const e=this.paymentUsage;return this.log("Creating Venmo instance with payment usage:",e),new Promise(((t,n)=>{void 0!==braintree.venmo?braintree.venmo.create({client:this.braintreeClient,allowDesktop:!0,paymentMethodUsage:e,collectCustomerBillingAddress:!0,collectCustomerShippingAddress:!0},((e,r)=>{e?n(e):(this.venmoInstance=r,t(r))})):n(new Error("Braintree Venmo SDK not loaded"))}))}isBrowserSupported(){return!!this.venmoInstance&&this.venmoInstance.isBrowserSupported()}static isUserCancellation(e){return e&&o.VENMO_CANCEL_CODES.includes(e.code)}async tokenize(){return new Promise(((e,t)=>{this.venmoInstance.tokenize(((n,r)=>{n?t(n):e(r)}))}))}blockUI(e){jQuery(e).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}unblockUI(e){jQuery(e).unblock()}handleError(e){return this.log("Venmo error:",e),o.isUserCancellation(e)?null:e.message||(0,r.__)("An error occurred while processing your Venmo payment. Please try again.","woocommerce-gateway-paypal-powered-by-braintree")}showError(e,t){const n=jQuery(t);jQuery(".woocommerce-error, .woocommerce-message").remove(),n.prepend('<div class="woocommerce-error">'+e+"</div>"),jQuery("html, body").animate({scrollTop:n.offset().top-100},500)}log(...e){this.debug&&console.log("[Venmo]",...e)}}},723:e=>{e.exports=window.wp.i18n}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r=n(723),o=n(32);jQuery((function(e){class t extends o.d{constructor(e){super(e),this.enabled=e.enabled,this.paymentUsage=e.payment_usage,this.cartPaymentNonce=e.cart_payment_nonce||"",this.checkoutForm="form.checkout",this.paymentMethodsContainer="ul.wc_payment_methods",this.init()}async init(){if(this.enabled)try{if(await this.getClientToken(),!this.clientToken)return void this.log("Failed to get client token");await this.createBraintreeClient(),await this.createDataCollector(),await this.createVenmoInstance(),this.attachEventHandlers(),this.isInitialized=!0,this.cartPaymentNonce&&this.prefillCartPaymentNonce(),this.log("Venmo checkout handler initialized")}catch(e){this.log("Venmo checkout initialization error:",e)}}attachEventHandlers(){const t=this;e(document).on("click","#wc_braintree_venmo_button",(function(e){e.preventDefault(),t.triggerVenmoFlow()})),e(this.checkoutForm).on("checkout_place_order_"+this.id,(function(){return t.validatePlaceOrder()})),e(document.body).on("checkout_error",(function(){t.isProcessing=!1,t.unblockUI(t.checkoutForm)})),e(document.body).on("change","input.js-wc-braintree-venmo-payment-token",(function(){t.toggleVenmoButton()})),this.toggleVenmoButton()}validatePlaceOrder(){return!!e("input.js-wc-braintree-venmo-payment-token:checked").val()||(!!e('input[name="wc_braintree_venmo_payment_nonce"]').val()||(this.renderError((0,r.__)('Please click the "Venmo" button below to authorize your payment with Venmo.',"woocommerce-gateway-paypal-powered-by-braintree")),!1))}async triggerVenmoFlow(){if(!this.isProcessing){this.isProcessing=!0,this.blockUI(this.checkoutForm);try{const t=await this.tokenize();e('input[name="wc_braintree_venmo_payment_nonce"]').val(t.nonce),e('input[name="wc_braintree_device_data"]').val(this.deviceData),e('input[name="wc_braintree_venmo_username"]').val(t.details.username),e(this.checkoutForm).submit()}catch(e){const t=super.handleError(e);t&&this.renderError(t),this.isProcessing=!1,this.unblockUI(this.checkoutForm)}}}renderError(e){this.showError(e,this.checkoutForm)}toggleVenmoButton(){const t=e("input.js-wc-braintree-venmo-payment-token:checked").val(),n=e(".wc-braintree-venmo-button-container");t?n.hide():n.show()}prefillCartPaymentNonce(){e('input[name="wc_braintree_venmo_payment_nonce"]').val(this.cartPaymentNonce),this.deviceData&&e('input[name="wc_braintree_device_data"]').val(this.deviceData)}}window.WC_Braintree_Venmo_Checkout_Handler=t,e(document.body).trigger("wc_braintree_venmo_checkout_handler_loaded")}))})();