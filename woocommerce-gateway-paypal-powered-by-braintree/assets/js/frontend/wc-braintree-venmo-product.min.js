(()=>{"use strict";var t={32:(t,e,o)=>{o.d(e,{d:()=>n});var r=o(723);class n{static VENMO_CANCEL_CODES=["VENMO_CANCELED","VENMO_APP_CANCELED","VENMO_DESKTOP_CANCELED"];constructor(t){this.args=t||{},this.id=t.id,this.clientTokenNonce=t.client_token_nonce,this.ajaxUrl=t.ajax_url,this.debug=t.debug||!1,this.paymentUsage=t.payment_usage,this.braintreeClient=null,this.venmoInstance=null,this.dataCollectorInstance=null,this.deviceData=null,this.clientToken=null,this.isInitialized=!1,this.isProcessing=!1}async getClientToken(){const t={action:"wc_"+this.id+"_get_client_token",nonce:this.clientTokenNonce};try{const e=await jQuery.post(this.ajaxUrl,t);if(!e.success||!e.data)throw new Error(e.data?.message||"Failed to get client token");this.clientToken=e.data}catch(t){throw this.log("Error fetching client token:",t),t}}async createBraintreeClient(){return new Promise(((t,e)=>{"undefined"!=typeof braintree&&void 0!==braintree.client?braintree.client.create({authorization:this.clientToken},((o,r)=>{o?e(o):(this.braintreeClient=r,t(r))})):e(new Error("Braintree SDK not loaded"))}))}async createDataCollector(){return new Promise((t=>{if(void 0===braintree.dataCollector)return this.log("Data collector not available, skipping"),void t(null);braintree.dataCollector.create({client:this.braintreeClient,kount:!0},((e,o)=>{if(e)return this.log("Data collector creation failed:",e),void t(null);this.dataCollectorInstance=o,this.deviceData=o.deviceData,t(o)}))}))}async createVenmoInstance(){const t=this.paymentUsage;return this.log("Creating Venmo instance with payment usage:",t),new Promise(((e,o)=>{void 0!==braintree.venmo?braintree.venmo.create({client:this.braintreeClient,allowDesktop:!0,paymentMethodUsage:t,collectCustomerBillingAddress:!0,collectCustomerShippingAddress:!0},((t,r)=>{t?o(t):(this.venmoInstance=r,e(r))})):o(new Error("Braintree Venmo SDK not loaded"))}))}isBrowserSupported(){return!!this.venmoInstance&&this.venmoInstance.isBrowserSupported()}static isUserCancellation(t){return t&&n.VENMO_CANCEL_CODES.includes(t.code)}async tokenize(){return new Promise(((t,e)=>{this.venmoInstance.tokenize(((o,r)=>{o?e(o):t(r)}))}))}blockUI(t){jQuery(t).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}unblockUI(t){jQuery(t).unblock()}handleError(t){return this.log("Venmo error:",t),n.isUserCancellation(t)?null:t.message||(0,r.__)("An error occurred while processing your Venmo payment. Please try again.","woocommerce-gateway-paypal-powered-by-braintree")}showError(t,e){const o=jQuery(e);jQuery(".woocommerce-error, .woocommerce-message").remove(),o.prepend('<div class="woocommerce-error">'+t+"</div>"),jQuery("html, body").animate({scrollTop:o.offset().top-100},500)}log(...t){this.debug&&console.log("[Venmo]",...t)}}},723:t=>{t.exports=window.wp.i18n}},e={};function o(r){var n=e[r];if(void 0!==n)return n.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,o),i.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r=o(723),n=o(32);jQuery((function(t){class e extends n.d{constructor(t){super(t),this.productCheckoutUrl=t.product_checkout_url,this.productCheckoutNonce=t.product_checkout_nonce,this.validateProductUrl=t.validate_product_url,this.validateProductNonce=t.validate_product_nonce,this.shouldValidateProductData=t.should_validate_product_data||!1,this.buttonContainerId="wc_"+this.id+"_button_container",this.addToCartForm="form.cart"}async init(){try{if(await this.getClientToken(),!this.clientToken)return void this.log("Failed to get client token");await this.createBraintreeClient(),await this.createDataCollector(),await this.createVenmoInstance(),await this.renderVenmoButton(),this.attachEventHandlers(),this.isInitialized=!0,this.log("Venmo product button initialized")}catch(t){this.log("Venmo product button initialization error:",t)}}async renderVenmoButton(){const t=document.getElementById(this.buttonContainerId);if(!t)return void this.log("Button container not found");if(!this.venmoInstance.isBrowserSupported())return this.log("Venmo not supported in this browser"),void(t.style.display="none");const e=document.createElement("button");e.type="button",e.id="wc_braintree_venmo_product_button",e.className="wc-braintree-venmo-button";const o=document.createElement("img");o.src=this.args.venmo_logo_svg_url,o.alt=(0,r.__)("Buy Now with Venmo","woocommerce-gateway-paypal-powered-by-braintree"),e.appendChild(o),e.addEventListener("click",(t=>{t.preventDefault(),this.handleButtonClick()})),t.appendChild(e)}attachEventHandlers(){this.shouldValidateProductData&&t(this.addToCartForm).on("change","input, select, textarea",(()=>{this.validateProduct()}))}async validateProduct(){const e={cart_form:t(this.addToCartForm).serialize(),product_id:t('input[name="product_id"], button[name="add-to-cart"]').val(),wp_nonce:this.validateProductNonce};try{const o=await t.post(this.validateProductUrl,e);if(o.success&&o.data){const t=document.getElementById("wc_braintree_venmo_product_button");t&&(t.disabled=!o.data.is_valid)}}catch(t){this.log("Error validating product:",t)}}async handleButtonClick(){if(!this.isProcessing){this.isProcessing=!0,this.blockUI(this.addToCartForm);try{const t=await this.tokenize();await this.processCheckout(t)}catch(t){const e=this.handleError(t);e&&this.showError(e,this.addToCartForm),this.isProcessing=!1,this.unblockUI(this.addToCartForm)}}}async processCheckout(e){const o=t(this.addToCartForm).serialize(),r=t('input[name="product_id"], button[name="add-to-cart"]').val(),n={nonce:e.nonce,device_data:this.deviceData||"",cart_form:o,product_id:r,wp_nonce:this.productCheckoutNonce};try{const e=await t.post(this.productCheckoutUrl,n);if(!e.redirect_url)throw new Error("No redirect URL received");window.location.href=e.redirect_url}catch(t){throw this.log("Error processing checkout:",t),t}}}window.WC_Braintree_Venmo_Product_Button_Handler=e}))})();