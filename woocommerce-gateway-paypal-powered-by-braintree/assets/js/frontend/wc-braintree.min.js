(()=>{var e=[].indexOf,t=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};jQuery(document).ready((function(r){"use strict";var i,n,a;return window.WC_Braintree_Payment_Form_Handler=class{constructor(e){this.show_integration_ui=this.show_integration_ui.bind(this),this.hide_integration_ui=this.hide_integration_ui.bind(this),this.id=e.id,this.id_dasherized=e.id_dasherized,this.name=e.name,this.type=e.type,this.debug=e.debug,this.client_token_nonce=e.client_token_nonce,this.ajax_url=e.ajax_url,this.integration_error_message=e.integration_error_message,this.payment_error_message=e.payment_error_message,this.is_block_theme=e.is_block_theme,this.error_class=this.is_block_theme?"wc-block-components-notice-banner is-error":"woocommerce-error",this.error_class_selector=this.is_block_theme?".wc-block-components-notice-banner.is-error":".woocommerce-error",this.params=window.sv_wc_payment_gateway_payment_form_params,this.apple_pay_card_tokens=e.card_tokens}init(){return this.is_sdk_ready()?r("form.checkout").length?this.handle_checkout_page():r("form#order_review").length?this.handle_pay_page():r("form#add_payment_method").length?this.handle_add_payment_method_page():void 0:console.error("Braintree SDK is missing.")}handle_checkout_page(){return this.form=r("form.checkout"),this.form_ui_selector=".woocommerce-checkout-payment",r(document.body).on("updated_checkout",(()=>{if(!this.setting_up)return r('iframe[name^="braintree-"]').remove(),this.setup_braintree()})),r(document.body).on("updated_checkout",(()=>this.handle_saved_payment_methods())),r(document.body).on("checkout_error",(()=>this.handle_checkout_error())),this.form.on(`checkout_place_order_${this.id}`,(()=>{if(this.is_selected())return this.block_ui(),this.verify_form()}))}handle_checkout_error(){return this.unblock_ui()}handle_pay_page(){return this.form=r("form#order_review"),this.form_ui_selector="#payment",this.handle_saved_payment_methods(),this.setup_braintree(),this.form.submit((()=>{if(this.is_selected())return this.block_ui(),this.verify_form()}))}handle_add_payment_method_page(){return this.form=r("form#add_payment_method"),this.form_ui_selector="#payment",this.setup_braintree(),this.form.submit((()=>{if(this.is_selected())return this.block_ui(),this.verify_form()}))}verify_form(){return!!this.using_payment_token()||!!this.has_payment_nonce()&&void 0}submit_form(e){return r(`input[name=wc_${this.id}_payment_nonce]`).val(e),this.form.submit()}handle_saved_payment_methods(){var e;if(e=r(`div.js-wc-${this.id_dasherized}-new-payment-method-form`),r(`input.js-wc-${this.id_dasherized}-payment-token`).change((()=>r(`input.js-wc-${this.id_dasherized}-payment-token:checked`).val()?e.slideUp(200):e.slideDown(200))).change(),r("input#createaccount").change((e=>{var t;return t=r(`input.js-wc-${this.id_dasherized}-tokenize-payment-method`).closest("p.form-row"),r(e.target).is(":checked")?(t.slideDown(),t.next().show()):(t.hide(),t.next().hide())})),!r("input#createaccount").is(":checked"))return r("input#createaccount").change()}setup_braintree(){if(!r(`#wc-${this.id_dasherized}-account-number-hosted iframe`).data("ready"))return this.setting_up=!0,this.block_ui(),r(`input[name=wc_${this.id}_payment_nonce]`).val(""),this.create_client()}create_client(){return this.log("Creating client."),this.get_client_token().done((e=>e.success?braintree.client.create({authorization:e.data}).then((e=>(this.client=e,this.log("Client ready."),this.setup_integration()))).catch((e=>(this.handle_integration_error(e),this.unblock_ui()))):this.handle_integration_error(e.data))).fail(((e,t,r)=>(this.handle_integration_error({message:"Could not retrieve the client token via AJAX: "+r}),this.unblock_ui())))}get_client_token(){var e;return this.id,e={action:`wc_${this.id}_get_client_token`,nonce:this.client_token_nonce},r.post(this.ajax_url,e)}setup_integration(){return this.set_device_data(),this.log("Creating integration."),this.get_integration_class().create(this.get_integration_options()).then((e=>(this.integration=e,this.show_integration_ui(),r(`#wc-${this.id_dasherized}-account-number-hosted iframe`).data("ready",!0),this.do_integration_ready(),r(document).trigger(`wc_${this.id}_integration_ready`,this.integration),this.log("Integration ready."),this.setting_up=!1))).catch((e=>(this.handle_integration_error(e),this.unblock_ui(),this.setting_up=!1)))}refresh_braintree(){if(null!=this.integration&&!this.refreshing&&!this.setting_up)return this.log("Refreshing integration."),this.refreshing=!0,this.block_ui(),this.integration.teardown((()=>(this.integration=null,this.refreshing=!1,this.setup_braintree())))}teardown_braintree(){if(null!=this.integration&&!this.tearing_down&&!this.setting_up)return this.log("Tearing down integration."),this.tearing_down=!0,this.block_ui(),this.integration.teardown((()=>(this.integration=null,this.tearing_down=!1,this.unblock_ui())))}set_device_data(){if(braintree&&braintree.dataCollector)return braintree.dataCollector.create({client:this.client}).then((e=>{if(e&&e.deviceData)return r("input[id*='wc_braintree_device_data']").val(e.deviceData)}))}do_integration_ready(){}get_integration_options(){return{client:this.client}}get_integration_class(){}handle_integration_error(e){return this.log("Integration error. "+e.message,e,"error"),this.hide_integration_ui(),this.unblock_ui()}handle_payment_error(e){return this.log("Payment error. "+e.message,e,"error"),this.render_error(this.get_user_message(e)),this.unblock_ui()}render_error(e){return r(this.error_class_selector+", .woocommerce-message").remove(),this.form.prepend('<div class="'+this.error_class+'">'+e+"</div>").removeClass("processing").unblock(),r("html, body").animate({scrollTop:this.form.offset().top-100},1e3),r(`input[name=wc_${this.id}_payment_nonce]`).val(""),this.form.trigger(`wc_${this.id}_rendered_error`),r(document.body).trigger("checkout_error"),this.unblock_ui()}get_user_message(e){return this.payment_error_message}show_integration_ui(){if(r(`div.js-wc-${this.id_dasherized}-new-payment-method-form`).find(this.error_class_selector).remove(),r("input#createaccount").length&&r("input#createaccount").is(":checked"))return r(`div.js-wc-${this.id_dasherized}-new-payment-method-form`).find(".form-row").show()}hide_integration_ui(){return r(`div.js-wc-${this.id_dasherized}-new-payment-method-form`).prepend('<div class="'+this.error_class+'">'+this.integration_error_message+"</div>"),r(`div.js-wc-${this.id_dasherized}-new-payment-method-form`).find(".form-row").hide()}block_ui(){return r(this.form_ui_selector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}unblock_ui(){return r(this.form_ui_selector).unblock()}is_selected(){return this.get_selected_gateway_id()===this.id}is_sdk_ready(){return"undefined"!=typeof braintree&&null!==braintree&&null!=braintree.client&&null!=this.get_integration_class()}has_payment_nonce(){return this.form.find(`input[name=wc_${this.id}_payment_nonce]`).val()}using_payment_token(){return this.form.find(`input.js-wc-${this.id_dasherized}-payment-token:checked`).val()}get_selected_gateway_id(){return this.form.find("input[name=payment_method]:checked").val()}log(e,t=null,r="info"){if(this.debug)return console.log(`${this.name}: ${e}`),t?console.log(t):void 0}},r(document.body).trigger("wc_braintree_payment_form_handler_loaded"),i=window.WC_Braintree_Credit_Card_Payment_Form_Handler=class extends WC_Braintree_Payment_Form_Handler{constructor(e){super(e),this.show_integration_ui=this.show_integration_ui.bind(this),this.hide_integration_ui=this.hide_integration_ui.bind(this),this.csc_required=e.csc_required,this.hosted_fields_styles=e.hosted_fields_styles,this.threeds=e.threeds,this.enabled_card_types=e.enabled_card_types,this.init()}handle_checkout_error(){return super.handle_checkout_error(),r(`input[name=wc_${this.id}_payment_nonce]`).val(""),r(`input[name=wc-${this.id_dasherized}-card-type]`).val(""),r(`input[name=wc-${this.id_dasherized}-3d-secure-verified]`).val(0)}verify_form(){var e;return this.has_payment_nonce()||!this.csc_required&&this.using_payment_token()?(e=r("input.js-wc-braintree-credit-card-payment-token:checked"),this.should_verify_3d_secure_token(e)?(this.verify_3d_secure(e.data("nonce"),e.data("bin"),e),!1):super.verify_form()):(this.tokenize_payment(),!1)}tokenize_payment(){return this.integration.tokenize().then((e=>{if(this.log("Payment method received.",e),null!=e.nonce&&null!=e.details&&null!=e.details.bin)return this.should_verify_3d_secure(e)?this.verify_3d_secure(e.nonce,e.details.bin):this.submit_form(e.nonce)})).catch((e=>this.handle_payment_error(e)))}get_integration_options(){var e;return e={client:this.client,fields:{number:{selector:"#wc-braintree-credit-card-account-number-hosted",placeholder:r("#wc-braintree-credit-card-account-number-hosted").data("placeholder")},cvv:{selector:"#wc-braintree-credit-card-csc-hosted",placeholder:r("#wc-braintree-credit-card-csc-hosted").data("placeholder")},expirationDate:{selector:"#wc-braintree-credit-card-expiry-hosted",placeholder:r("#wc-braintree-credit-card-expiry-hosted").data("placeholder")}},styles:this.hosted_fields_styles},this.csc_required&&this.using_payment_token()&&(delete e.fields.number,delete e.fields.expirationDate),this.csc_required||delete e.fields.cvv,e}get_integration_class(){return braintree.hostedFields}do_integration_ready(){return this.integration.on("cardTypeChange",(e=>this.on_card_type_change(e))),!this.csc_required&&r("input.js-wc-braintree-credit-card-payment-token:checked").val()&&this.teardown_braintree(),this.unblock_ui()}handle_saved_payment_methods(){var e,t;return super.handle_saved_payment_methods(),t=r("div.js-wc-braintree-credit-card-new-payment-method-form"),e=r("div.wc-braintree-hosted-field-card-csc-parent"),r("input.js-wc-braintree-credit-card-payment-token").change((()=>r("input.js-wc-braintree-credit-card-payment-token:checked").val()?this.csc_required&&e.hasClass("form-row-last")?(e.removeClass("form-row-last").addClass("form-row-first"),t.after(e),this.refresh_braintree()):void 0:(this.csc_required&&e.hasClass("form-row-first")&&(e.removeClass("form-row-first").addClass("form-row-last"),t.find("div.wc-braintree-hosted-field-card-expiry-parent").after(e)),this.refresh_braintree()))).change()}get_user_message(e){var t,r,i,n,a;if(n=[],"CUSTOMER"===e.type)switch(e.code){case"HOSTED_FIELDS_FIELDS_EMPTY":this.csc_required&&n.push(this.params.cvv_missing),this.using_payment_token()||(n.push(this.params.card_number_missing),n.push(this.params.card_exp_date_invalid));break;case"HOSTED_FIELDS_FIELDS_INVALID":if(null!=e.details)for(t=0,r=(a=e.details.invalidFieldKeys).length;t<r;t++)switch(a[t]){case"number":n.push(this.params.card_number_invalid);break;case"cvv":n.push(this.params.cvv_length_invalid);break;case"expirationDate":n.push(this.params.card_exp_date_invalid)}break;default:null!=e.message&&n.push(e.message),null!=e.error&&null!=e.error.message&&n.push(e.error.message),null!=e.details&&null!=e.details.originalError&&(n=n.concat(this.get_user_message(e.details.originalError)))}else"NETWORK"===e.type&&null!=e.details.originalError.error.message&&(i=e.details.originalError.error.message,/given name format is invalid/.test(i)?n.push(this.params.first_name_unsupported_characters):/surname format is invalid/.test(i)?n.push(this.params.last_name_unsupported_characters):n.push(i));return n.length?n.join("<br/>"):super.get_user_message()}on_card_type_change(t){var i,n,a;if(null!=t.cards)return(i=r("#wc-braintree-credit-card-account-number-hosted")).attr("class",(function(e,t){return t.replace(/(^|\s)card-type-\S+/g,"")})),t.cards.length?1===t.cards.length?(n=t.cards[0],r(`input[name=wc-${this.id_dasherized}-card-type]`).val(n.type),null!=n.type&&(a=n.type,e.call(this.enabled_card_types,a)>=0)?i.addClass(`card-type-${n.type}`):i.addClass("card-type-invalid")):void 0:i.addClass("card-type-invalid")}is_3d_secure_enabled(){return this.threeds.enabled&&null!=braintree.threeDSecure}setup_integration(){return this.threeds.enabled&&(this.threeds.enabled=this.client.getConfiguration().gatewayConfiguration.threeDSecureEnabled),this.is_3d_secure_enabled()?(r(`input[name=wc-${this.id_dasherized}-3d-secure-enabled]`).val(1),this.threeDSecure&&this.threeDSecure.teardown(),braintree.threeDSecure.create({version:2,client:this.client}).then((e=>(this.threeDSecure=e,r(document.body).on("click","#wc-braintree-credit-card-3dsecure-container",(e=>(r(e.currentTarget).fadeOut(200),this.threeDSecure.cancelVerifyCard(),this.unblock_ui()))),super.setup_integration()))).catch((e=>this.handle_integration_error(e)))):super.setup_integration()}should_verify_3d_secure(t){var r;return r=t.details.cardType,this.is_3d_secure_enabled()&&"CreditCard"===t.type&&e.call(this.threeds.card_types,r)>=0}should_verify_3d_secure_token(e){return!this.apple_pay_card_tokens.includes(e.val())&&(!(!(this.is_3d_secure_enabled()&&e.val()&&e.data("nonce"))||e.data("verified"))||void 0)}verify_3d_secure(e,t,i=null){var n,a,s,_,o,d,h;return _=r("#billing_state").val(),s=r("#billing_country").val(),d=r("#shipping_state").val(),o=r("#shipping_country").val(),a=r("input[name=billing_first_name]").val()?{givenName:r("input[name=billing_first_name]").val().latinise(),surname:r("input[name=billing_last_name]").val().latinise(),phoneNumber:r("input[name=billing_phone]").val(),streetAddress:r("input[name=billing_address_1]").val(),extendedAddress:r("input[name=billing_address_2]").val(),locality:r("#billing_city").val(),region:"string"==typeof _&&_.length<=2?_:"",postalCode:r("input[name=billing_postcode]").val(),countryCodeAlpha2:"string"==typeof s&&s.length<=2?s:""}:{},n=r("input[name=shipping_first_name]").val()?{shippingGivenName:r("input[name=shipping_first_name]").val().latinise(),shippingSurname:r("input[name=shipping_last_name]").val().latinise(),shippingAddress:{streetAddress:r("input[name=shipping_address_1]").val(),extendedAddress:r("input[name=shipping_address_2]").val(),locality:r("input[name=shipping_city]").val(),region:"string"==typeof d&&d.length<=2?d:"",postalCode:r("input[name=shipping_postcode]").val(),countryCodeAlpha2:"string"==typeof o&&o.length<=2?o:""}}:{},h={nonce:e,amount:r(`input[name=wc-${this.id_dasherized}-3d-secure-order-total]`).val(),email:r("input[name=billing_email]").val(),billingAddress:a,bin:t,additionalInformation:n,challengeRequested:!0,onLookupComplete:(e,t)=>{var r;this.log("3D Secure lookup complete.",e);try{return t()}catch(e){return r=e,this.handle_payment_error(r)}}},this.log("Verifying 3D Secure.",h),this.threeDSecure.verifyCard(h).then((e=>(this.log("3D Secure response received.",e),this.threeds.liability_shift_always_required&&!e.liabilityShifted?this.render_error(this.threeds.failure_message):(null!=i&&i.data("verified",!0),r(`input[name=wc-${this.id_dasherized}-3d-secure-verified]`).val(1),this.submit_form(e.nonce))))).catch((e=>this.handle_payment_error(e)))}show_integration_ui(){return t(this,i),super.show_integration_ui(),r(".wc-braintree-hosted-field-parent").show()}hide_integration_ui(){return t(this,i),super.hide_integration_ui(),r(".wc-braintree-hosted-field-parent").hide()}},r(document.body).trigger("wc_braintree_credit_card_payment_form_handler_loaded"),n=window.WC_Braintree_PayPal_Payment_Form_Handler=class extends WC_Braintree_Payment_Form_Handler{constructor(e){super(e),this.do_integration_ready=this.do_integration_ready.bind(this),this.on_approve=this.on_approve.bind(this),this.get_linked_account_html=this.get_linked_account_html.bind(this),this.is_test_environment=e.is_test_environment,this.is_paypal_pay_later_enabled=e.is_paypal_pay_later_enabled,this.is_paypal_card_enabled=e.is_paypal_card_enabled,this.disabled_funding_options=e.paypal_disabled_funding_options,this.force_buyer_country=e.force_buyer_country,this.must_login_message=e.must_login_message,this.must_login_add_method_message=e.must_login_add_method_message,this.button_styles=e.button_styles,this.cart_payment_nonce=e.cart_payment_nonce,this.paypal_intent=e.paypal_intent,this.init()}init(){return super.init(),r(`input[name=wc_${this.id}_payment_nonce]`).val(this.cart_payment_nonce),r(document.body).on("click",'input[name="payment_method"], input.js-wc-braintree-paypal-payment-token',(()=>this.toggle_order_button())),r(document.body).on("payment_method_selected",(()=>this.toggle_order_button())),r(document.body).on("click",".wc-braintree-paypal-account .cancel",(e=>(e.preventDefault(),r(e.currentTarget).parent().remove(),this.setup_braintree()))),r(document.body).on("update_checkout",(e=>this.teardown_braintree()))}toggle_order_button(){return!this.is_selected()||this.has_payment_nonce()||this.using_payment_token()?r("#place_order").show():r("#place_order").hide()}verify_form(){var e;return e=super.verify_form(),this.has_payment_nonce()||this.using_payment_token()||this.render_error(this.must_login_message),e}handle_payment_error(e){return super.handle_payment_error(e),this.cart_payment_nonce=!1,this.setup_braintree()}get_integration_class(){return braintree.paypalCheckout}setup_braintree(){return this.cart_payment_nonce?this.unblock_ui():(super.setup_braintree(),r("input.js-wc-braintree-paypal-tokenize-payment-method").prop("disabled",!1),this.toggle_order_button())}do_integration_ready(){return t(this,n),this.cart_payment_nonce?this.unblock_ui():this.load_paypal_sdk()}load_paypal_sdk(){var e,t;return t=this.get_sdk_options(),this.paypal_sdk_loaded&&this.previous_paypal_sdk_options&&JSON.stringify(this.previous_paypal_sdk_options)===JSON.stringify(t)?this.do_paypal_sdk_loaded():(e=t,this.paypal_sdk_messages_component_loaded&&(e.components="buttons"),this.integration.loadPayPalSDK(e,(()=>(this.paypal_sdk_loaded=!0,this.previous_paypal_sdk_options=t,paypal.Messages&&(this.paypal_sdk_messages_component_loaded=!0),this.do_paypal_sdk_loaded()))))}do_paypal_sdk_loaded(){var e;return e=this.is_single_use()?"checkout":"vault",this.render_pay_later_messaging(),this.render_button(this.integration.createPayment({flow:e,intent:this.is_single_use()?this.paypal_intent:"tokenize",amount:this.get_order_amount(),currency:this.get_store_currency(),locale:this.get_store_locale(),enableShippingAddress:this.get_needs_shipping()}),this.get_button_styles(),"#wc_braintree_paypal_container").then((()=>("undefined"===this.get_button_styles().height&&r("#wc_braintree_paypal_container").css({width:"100%"}),this.unblock_ui()))).catch((e=>(this.log("Could not render the PayPal button. "+e.message,e),this.hide_integration_ui(),this.unblock_ui())))}render_pay_later_messaging(){var e;if((e=r("#wc_braintree_paypal_pay_later_messaging_container")).length)return paypal.Messages?paypal.Messages({amount:this.get_order_amount()}).render("#wc_braintree_paypal_pay_later_messaging_container").catch((e=>this.log("Could not render the PayPal Pay Later messeging. "+e.message,e))):e.hide()}render_button(e,t,i){var n;return r(i).html(""),n={env:this.is_test_environment?"sandbox":"production",commit:this.button_is_pay_now(),style:t,onApprove:(e,t)=>this.on_approve(e,t),onError:e=>this.handle_integration_error(e)},this.is_single_use()?n.createOrder=()=>e:n.createBillingAgreement=()=>e,paypal.Buttons(n).render(i)}button_is_pay_now(){return!r("form#add_payment_method").length}get_button_styles(){return this.button_styles}on_approve(e,r){return t(this,n),this.block_ui(),this.integration.tokenizePayment(e).then((e=>(this.log("Payment method tokenized.",e),this.set_payment_method(e)))).catch((e=>(this.handle_payment_error(e),this.unblock_ui())))}set_payment_method(e){return r(`input[name=wc_${this.id}_payment_nonce]`).val(e.nonce),r("#wc_braintree_paypal_container").html(this.get_linked_account_html(e.details)),this.is_single_use()&&r("input.js-wc-braintree-paypal-tokenize-payment-method").prop("disabled",!0),r("#place_order").show(),this.form.submit()}handle_saved_payment_methods(){return super.handle_saved_payment_methods(),r("input.js-wc-braintree-paypal-tokenize-payment-method").change((e=>{if(null!=this.integration&&r(e.target).is(":visible"))return this.block_ui(),this.do_integration_ready()})).change()}get_linked_account_html(e){var i;return t(this,n),i=r(`<div class='wc-${this.id_dasherized}-account'></div>`),null!=e.firstName&&null!=e.lastName&&i.append(`<span class='name'>${e.firstName} ${e.lastName}</span>`),i.append(`<span class='email'>${e.email}</span>`),i.append("<a href='#' class='cancel'>Cancel</a>"),i}is_single_use(){var e;return 0===(e=r("input[name=wc-braintree-paypal-tokenize-payment-method]")).length||("checkbox"===e.attr("type")?!e.is(":checked"):!e.val())}get_order_amount(){return r("input[name=wc_braintree_paypal_amount]").val()}get_store_currency(){return r("input[name=wc_braintree_paypal_currency]").val()}get_store_locale(){return r("input[name=wc_braintree_paypal_locale]").val()}get_needs_shipping(){return!!r("input[name=wc_braintree_paypal_needs_shipping]").val()}get_sdk_options(){var e,t,r;return[t,e]=[[],this.disabled_funding_options],this.is_paypal_card_enabled||e.push("card"),this.is_paypal_pay_later_enabled?t.push("paylater"):e.push("paylater"),r={components:this.is_paypal_pay_later_enabled?"buttons,messages":"buttons",currency:this.get_store_currency(),intent:this.is_single_use()?this.paypal_intent:"tokenize",vault:!this.is_single_use(),commit:this.button_is_pay_now()},this.force_buyer_country&&(r["buyer-country"]=this.force_buyer_country),t.length&&(r["enable-funding"]=t.join(",")),e.length&&(r["disable-funding"]=e.join(",")),r}},r(document.body).trigger("wc_braintree_paypal_payment_form_handler_loaded"),window.WC_Braintree_PayPal_Cart_Handler=class extends WC_Braintree_PayPal_Payment_Form_Handler{constructor(e){super(e),this.is_paypal_card_enabled=!1,this.set_payment_method_nonce=e.set_payment_method_nonce,this.cart_handler_url=e.cart_handler_url,this.form=r("form.woocommerce-cart-form"),this.form_ui_selector="",this.setup_braintree(),r(document.body).on("updated_cart_totals",(()=>this.setup_braintree()))}button_is_pay_now(){return!1}set_payment_method(e){if(null!=e.nonce)return e.wp_nonce=this.set_payment_method_nonce,r.ajax({type:"POST",url:this.cart_handler_url,data:e,dataType:"json"}).done((e=>{if(this.log("Cart response received.",e),null!=e.redirect_url)return window.location=e.redirect_url})).fail((e=>this.log("Error setting the PayPal cart data.",e,"error"))).always((()=>this.unblock_ui()))}is_single_use(){return"1"===r("input[name=wc_braintree_paypal_single_use]").val()}has_payment_nonce(){return!1}},r(document.body).trigger("wc_braintree_paypal_cart_handler_loaded"),a=window.WC_Braintree_PayPal_Product_Button_Handler=class extends WC_Braintree_PayPal_Payment_Form_Handler{constructor(e){super(e),this.do_integration_ready=this.do_integration_ready.bind(this),this.validate_product_button=this.validate_product_button.bind(this),this.validate_product_data=this.validate_product_data.bind(this),this.is_paypal_card_enabled=!1,this.product_checkout_nonce=e.product_checkout_nonce,this.product_checkout_url=e.product_checkout_url,this.is_product_page=e.is_product_page,this.validate_product_url=e.validate_product_url,this.validate_product_nonce=e.validate_product_nonce,this.should_validate_product_data=e.should_validate_product_data,this.form=r("form.woocommerce-cart-form"),this.form_ui_selector="",this.is_product_page&&this.handle_product_page(),this.setup_braintree(),r(document.body).on("updated_cart_totals",(()=>this.setup_braintree()))}handle_product_page(){return this.product_form={element:r("form.cart"),is_variable:r("form.cart").hasClass("variations_form")},this.should_validate_product_data&&this.product_form.element.on("change",this.validate_product_button),this.product_form.is_variable&&r(document.body).on("woocommerce_variation_has_changed",this.validate_product_button),this.validate_product_button()}do_integration_ready(){if(t(this,a),super.do_integration_ready(),this.is_product_page)return this.validate_product_button()}validate_product_button(){if(t(this,a),this.product_form.is_variable&&this.product_form.element.find(".single_add_to_cart_button").is(".disabled"))this.hide_button();else{if(!this.should_validate_product_data)return this.show_button();this.validate_product_data(this.show_button,this.hide_button)}}validate_product_data(e,i){return t(this,a),r.ajax({type:"POST",url:this.validate_product_url,data:{wp_nonce:this.validate_product_nonce,product_id:r("input[name=wc_braintree_paypal_product_id]").val(),cart_form:r("form.cart").serialize()}}).done((t=>t.data.is_valid?(t.data.order_amount&&this.maybe_update_order_amount(t.data.order_amount),e()):i())).fail(i)}hide_button(){return r("#wc_braintree_paypal_container, #wc_braintree_paypal_pay_later_messaging_container").slideUp()}show_button(){return r("#wc_braintree_paypal_container, #wc_braintree_paypal_pay_later_messaging_container").slideDown()}maybe_update_order_amount(e){if(parseFloat(e)!==parseFloat(this.get_order_amount()))return r('[name="wc_braintree_paypal_amount"]').val(e),this.refresh_braintree()}button_is_pay_now(){return!1}set_payment_method(e){var t;if(null!=e.nonce)return(t=e).wp_nonce=this.product_checkout_nonce,t.product_id=r("input[name=wc_braintree_paypal_product_id]").val(),t.cart_form=r("form.cart").serialize(),r.ajax({type:"POST",url:this.product_checkout_url,data:t,dataType:"json"}).done((e=>{if(this.log("Cart response received.",e),null!=e.redirect_url)return window.location=e.redirect_url})).fail((e=>this.log("Error setting the PayPal cart data.",e,"error"))).always((()=>this.unblock_ui()))}is_single_use(){return"1"===r("input[name=wc_braintree_paypal_single_use]").val()}has_payment_nonce(){return!1}},r(document.body).trigger("wc_braintree_paypal_product_button_handler_loaded")}))})();